![CrowdStrike Falcon](https://raw.githubusercontent.com/CrowdStrike/falconpy/main/docs/asset/cs-logo.png)
![Twitter URL](https://img.shields.io/twitter/url?label=Follow%20%40CrowdStrike&style=social&url=https%3A%2F%2Ftwitter.com%2FCrowdStrike)

# Real Time Response examples
The examples within this folder focus on leveraging CrowdStrike's Real Time Response API to respond to security events.

- [Bulk Execute](#bulk-execute-a-command-on-matched-hosts) - Bulk execute a command on multiple hosts that you select by using a search string.
- [Dump Process Memory](pid-dump) - Dumps the memory for a running process on a target system.
- [My Little RTR](pony) - Retrieve System Information and draws ASCII art.


## Bulk execute a command on matched hosts
This simple example demonstrates performing batch administrative commands against
multiple hosts. The host list is calculated based upon a string match between the
hostname and a search string you provide at runtime. The command executed is also
provided at runtime, and passed to the target host in Raw format. (Default command: `ls -al`)

You must provide your credentials to the program at runtime, or have them pre-defined within your environment. These
environment variables are called `FALCON_CLIENT_ID` and `FALCON_CLIENT_SECRET`.

Results are output to the screen broken out by host.

### Running the program
In order to run this demonstration, you will need access to CrowdStrike API keys with the following scopes:
| Service Collection | Scope |
| :---- | :---- |
| Hosts | __READ__ |
| Real Time Response | __READ__, __WRITE__ |
| Real Time Response Admin | __READ__, __WRITE__ |

### Execution syntax
The following command line arguments are accepted.

| Argument | Long argument | Description |
| :-- | :-- | :-- |
|  `-h` | --help | Show help message and exit |
|  `-k` _FALCON_CLIENT_ID_ | --falcon_client_id _FALCON_CLIENT_ID_ | CrowdStrike Falcon API Client ID |
|  `-s` _FALCON_CLIENT_SECRET_ | --falcon_client_secret _FALCON_CLIENT_SECRET_ | CrowdStrike Falcon API Client Secret |
|  `-c` _COMMAND_ | --command _COMMAND_ | Command to perform. Defaults to `ls -al`. |
|  `-f` _FIND_ | --find _FIND_ | String to match against hostname to select hosts. |

The only required argument is _find_ (`-f`) which provides the search string to use to match against host names. If you do not have the `FALCON_CLIENT_ID` and `FALCON_CLIENT_SECRET` environment variables defined, then the `-k` and `-s` arguments are also required.

#### Example
This example will return the root directory contents for every host that matches the search string.

```shell
python3 bulk_execute.py -k CLIENT_ID -s CLIENT_SECRET -f search-string
```

You can specify a command to perform with the `-c` argument.

#### Example
This example will return the contents of `/etc/resolv.conf` for each host matched to the search string.

> This example command will only work on Linux or macOS host targets as this file does not exist in this location on Windows hosts.

```shell
python3 bulk_execute.py -k CLIENT_ID -s CLIENT_SECRET -f target -c "cat /etc/resolv.conf"
```

#### Example result

```shell
Starting sessions with target hosts.
Session with target-host-one started successfully. [42025f36-dcc1-4a3d-b4d6-5bed22944c1d]
Session with target-host-two started successfully. [33a06b79-0909-4c25-b51c-ed8a9d7f99f9]
Session with target-host-three started successfully. [a7696c1f-bb01-45be-873d-f98cbab07720]
Session with target-host-four started successfully. [1a61a71b-3f4e-4797-bd3a-cdcdd7ce165f]
Session with target-host-five started successfully. [9d7e1c3f-4bd0-4d0a-95b4-8e4c6b44caa6]

Executing command (`cat /etc/resolv.conf`) against target hosts.

Closing sessions with target hosts.
Session 42025f36-dcc1-4a3d-b4d6-5bed22944c1d deleted successfully.
Session 33a06b79-0909-4c25-b51c-ed8a9d7f99f9 deleted successfully.
Session a7696c1f-bb01-45be-873d-f98cbab07720 deleted successfully.
Session 1a61a71b-3f4e-4797-bd3a-cdcdd7ce165f deleted successfully.
Session 9d7e1c3f-4bd0-4d0a-95b4-8e4c6b44caa6 deleted successfully.

target-host-one
; generated by /usr/sbin/dhclient-script
search us-east-2.compute.internal
options timeout:2 attempts:5
nameserver 10.12.0.2

target-host-two
; generated by /usr/sbin/dhclient-script
search ap-southeast-2.compute.internal
options timeout:2 attempts:5
nameserver 10.7.0.12

target-host-three
; generated by /usr/sbin/dhclient-script
search eu-central-1.compute.internal
options timeout:2 attempts:5
nameserver 10.0.0.2

target-host-four
; generated by /usr/sbin/dhclient-script
search us-east-1.compute.internal
options timeout:2 attempts:5
nameserver 10.40.10.5

target-host-five
; generated by /usr/sbin/dhclient-script
search us-west-2.compute.internal
options timeout:2 attempts:5
nameserver 10.0.1.3
```

### Example source code
The source code for this example can be found [here](bulk_execute.py).